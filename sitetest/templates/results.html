<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>{% if full %}Full{% else %}Basic{% endif %} Site Test Results for {{site.title}}</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
        <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
        <style>
        .nav-tabs{
        	margin-bottom:15px;
        }
        ul, li{
        	list-style-type: none;
        }
        h1 a, h2 a, h3 a, h4 a, h5 a, h6 a {
			line-height: 1.5em;
		}
        </style>

        <link rel="icon" type="image/png" href="{{site.url}}/favicon.ico">

        <script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
        <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
		<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

    </head>
    <body>
    	<div class="container">
	        <h1>{% if full %}Full{% else %}Basic{% endif %} Site Test Results for &ldquo;{{site.title}}&rdquo;</h1>
	        <p>Test took {{duration}}, starting on {{start_time}} and ended on {{end_time}}</p>
	        <p>{{sorted_links|length}} links were tested.</p>

	        {% if messages.success|length > 0 %}
	        <section>
	        	<h2 style="display:none">Success</h2>
	        	<ul >
	        		{% for message in messages.success %}
					<li class="alert alert-success" role="alert">{{message}}</li>		        				
					{% endfor %}        		
	        	</ul>
	        </section>
	        {% endif %}

	        {% if messages.error|length > 0 %}
	        <section>
	        	<h2 style="display:none">Errors</h2>
	        	<ul >
	        		{% for message in messages.error %}
					<li class="alert alert-danger" role="alert">{{message}}</li>		        				
					{% endfor %}        		
	        	</ul>
	        </section>
	        {% endif %}

	        {% if messages.warning|length > 0 %}
	        <section>
	        	<h2 style="display:none">Warning</h2>
	        	<ul >
	        		{% for message in messages.warning %}
					<li class="alert alert-warning" role="alert">{{message}}</li>		        				
					{% endfor %}        		
	        	</ul>
	        </section>
	        {% endif %}

	        {% if messages.info|length > 0 %}
	        <section>
	        	<h2 style="display:none">Info</h2>
	        	<ul >
	        		{% for message in messages.info %}
					<li class="alert alert-info" role="alert">{{message}}</li>		        				
					{% endfor %}        		
	        	</ul>
	        </section>
	        {% endif %}

	        <section>
	        	<h2>Results</h2>

	        		
	        		<p>
		        		<button type="button" class="btn btn-default expand-all">Expand All <span class="glyphicon glyphicon-arrow-down"></span></button>
		        		<button type="button" class="btn btn-default collapse-all">Collapse All <span class="glyphicon glyphicon-arrow-up"></span></button>
		        	</p>

	        		{% for link in sorted_links %}
	        		
	        		<div class="panel panel-default">
				    <div class="panel-heading">
				        <h4 class="panel-title clearfix" id="load-test-result-{{links[link].url}}">
				        	<span class="pull-left">

				        		{% if links[link].response_code %} 
						        {% if links[link].response_code == 200 %}
						        <span class="label label-success">{{links[link].response_code}}</span> 
						        {% elif links[link].response_code == "Unknown" %} 
						        <span class="label label-warning">Response Code {{links[link].response_code}}</span> 
						        {% else %} 
						        <span class= "label label-danger">{{links[link].response_code}}</span>
						        {% endif %} 
						        {% else %}
						        <span class="label label-default">N/A</span> 
						        {% endif %}

					        	<a data-parent="#accordion" data-toggle="collapse" href="#load-test-result-body-{{loop.index}}">
					        		{% if links[link].title %}{{links[link].title}}<br /><br />{% endif %}
						        	{{links[link].url}}
						        	{% if links[link].url != links[link].ending_url %}
						        	> {{links[link].ending_url}}
						        	{% endif %}
						        </a>

						        
						    </span>
					    	
					    	<span class="pull-right">
					    		{% if links[link].messages.error|length > 0 %}
					    		<span class="label label-danger">Error <span class="glyphicon glyphicon-fire"></span></span>
					    		{% endif %}
					    		{% if links[link].messages.warning|length > 0 %}
					    		<span class="label label-warning">Warning <span class="glyphicon glyphicon-warning-sign"></span></span>
					    		{% endif %}
					    		{% if links[link].messages.info|length > 0 %}
					    		<span class="label label-info">Notice <span class="glyphicon glyphicon-hand-left"></span></span>
					    		{% endif %}
					    		<a class='fa fa-external-link' href="{{links[link].url}}" target="_blank"> Visit</a> 
					    	</span>
					    </h4>
				    </div>

				    <div class="panel-collapse collapse" id=
				    "load-test-result-body-{{loop.index}}">
				        <div class="panel-body">
				            

				            <!-- Nav tabs -->
							<ul class="nav nav-tabs" role="tablist">
							  <li class="active"><a href="#load-test-result-body-{{loop.index}}-stats" role="tab" data-toggle="tab">Stats</a></li>

							  {% if links[link].referers|length > 0 %}
							  <li><a href="#load-test-result-body-{{loop.index}}-referers" role="tab" data-toggle="tab">Referers</a></li>
							  {% endif %}

							  {% if links[link].links|length > 0 %}
							  <li><a href="#load-test-result-body-{{loop.index}}-links" role="tab" data-toggle="tab">Child Links</a></li>
							  {% endif %}

							  {% if links[link].validation %}
							  {% if links[link].validation.warnings|length > 0 or links[link].validation.errors|length > 0 %}
							  <li><a href="#load-test-result-body-{{loop.index}}-validation" role="tab" data-toggle="tab">Validation</a></li>
							  {% endif %}
							  <li><a href="#load-test-result-body-{{loop.index}}-source" role="tab" data-toggle="tab">Source</a></li>
							  {% endif %}

							  <li><a href="#load-test-result-body-{{loop.index}}-tools" role="tab" data-toggle="tab">Tools</a></li>
							  
							</ul>



							<!-- Tab panes -->
							<div class="tab-content">
							  <div class="tab-pane active" id="load-test-result-body-{{loop.index}}-stats">
							  	<ul>
								  	{% if links[link].response_load_time %}
						            <li>This page took {{links[link].response_load_time}}ms to load.</li>
						            {% endif %}

						            {% if links[link].alias_to %}
						            <li>This page is an alias to {{links[link].alias_to}}</li>
						        	{% endif %}

						            {% if links[link].description %}
						            <li><strong>Page description:</strong> {{links[link].description}}</li>{% endif %}

						            {% for message in links[link].messages.success %}
									<li class="alert alert-success" role="alert">{{message}}</li>		        				
									{% endfor %}   

									{% for message in links[link].messages.error %}
									<li class="alert alert-danger" role="alert">{{message}}</li>		        				
									{% endfor %}  

									{% for message in links[link].messages.warning %}
									<li class="alert alert-warning" role="alert">{{message}}</li>		        				
									{% endfor %}  

									{% for message in links[link].messages.info %}
									<li class="alert alert-info" role="alert">{{message}}</li>		        				
									{% endfor %}  
								</ul>   
						        

								{% if links[link].redirect_path %}
								<h4>Redirect Path</h4>
								<ul>
						            {% for item in links[link].redirect_path %}
						            <li><strong>{{item.response_code}}</strong> {{item.url}} [{{item.response_content_type}}] - <em>{{item.response_load_time}} ms</em></li>
						            {% endfor %}
						        </ul>
						        {% endif %}

							  </div>

							  {% if links[link].referers|length > 0 %}
							  <div class="tab-pane" id="load-test-result-body-{{loop.index}}-referers">


							  	<h5>There are {{links[link].referers|length}} links that refer
				                to this page</h5>

				                <ul>
				                    <li style="list-style: none">{% for referer in
				                    links[link].referers %}</li>

				                    <li>
				                        <a href="#load-test-result-{{referer}}">{{referer}}</a>
				                    </li>

				                    <li style="list-style: none">{% endfor %}</li>
				                </ul>


							  </div>
							  {% endif %}

							  {% if links[link].links|length > 0 %}
							  <div class="tab-pane" id="load-test-result-body-{{loop.index}}-links">


					            <section class="link-children">
					                <h5>There are {{links[link].links|length}} links within this
					                page</h5>

					                <ul>
					                    <li style="list-style: none">{% for child in
					                    links[link].links %}</li>

					                    <li>
					                        <a href="#load-test-result-{{child}}">{{child}}</a>
					                    </li>

					                    <li style="list-style: none">{% endfor %}</li>
					                </ul>
					            </section>

							  </div>
							  {% endif %}

							  {% if links[link].validation %}
							  {% if links[link].validation.warnings|length > 0 or links[link].validation.errors|length > 0 %}
							  <div class="tab-pane" id="load-test-result-body-{{loop.index}}-validation">
							  	
							  	{% for message in links[link].validation.errors %}
								<li class="alert alert-warning" role="alert">

									{% if message.lastLine %}

									<p>Error on Line {{message.lastLine}}, Column {{message.lastColumn}}: <strong>{{message.message}}</strong></p>
									<pre>{{message.src|e}}</pre>

									{% else %}
									
									<p>Error:</p>
									<pre>{{message|e}}</pre>
									
									{% endif %}
								</li>		        				
								{% endfor %}  

							  	{% for message in links[link].validation.warnings %}
								<li class="alert alert-info" role="alert">
									<p>Warning Line {{message.lastLine}}, Column {{message.lastColumn}}: <strong>{{message.message}}</strong></p>
									<pre>{{message.src|e}}</pre>
								</li>		        				
								{% endfor %}  

							  </div>

							  {% endif %}
							  <div class="tab-pane" id="load-test-result-body-{{loop.index}}-source">
							  	<pre>{{links[link].enumerated_html|e}}</pre>
							  </div>
							  {% endif %}


							  <div class="tab-pane" id="load-test-result-body-{{loop.index}}-tools">



				                <ul>
				                    <li>
				                        <a class='fa fa-external-link' href=
				                        "http://www.browserstack.com/start#url={{links[link].encoded_url}}&resolution=1280x1024"
				                        target="_blank"> View in Browserstack</a>
				                    </li>

				                    <li>
				                        <a class='fa fa-external-link' href=
				                        "http://validator.w3.org/check?uri={{links[link].encoded_url}}&charset=%28detect+automatically%29&doctype=Inline&group=0"
				                        target="_blank"> Validate HTML on W3C</a>
				                    </li>

				                    <li>
				                        <a class='fa fa-external-link' href=
				                        "http://nibbler.silktide.com/" target="_blank"> Test on
				                        Nibblr</a>
				                    </li>

				                    <li>
				                        <a class='fa fa-external-link' href=
				                        "http://developers.google.com/speed/pagespeed/insights/?url={{links[link].url}}"
				                        target="_blank"> Google Page Speed</a>
				                    </li>

				                    <li>
				                        <a class='fa fa-external-link' href=
				                        "http://tools.pingdom.com/fpt/" target="_blank"> Pingdom
				                        Page Speed</a>
				                    </li>

				                    <li>
				                        <a class='fa fa-external-link' href=
				                        "https://cards-dev.twitter.com/validator" target=
				                        "_blank"> Twitter Card Validator</a>
				                    </li>

				                    <li>
				                        <a class='fa fa-external-link' href=
				                        "https://developers.facebook.com/tools/debug/og/object"
				                        target="_blank"> Facebook OG Validator</a>
				                    </li>

				                    <li>
				                        <a class='fa fa-external-link' href=
				                        "http://www.google.com/webmasters/tools/richsnippets?q={{links[link].url}}"
				                        target="_blank"> Google Structured Data Validator</a>
				                    </li>
				                </ul>

							  </div>
							</div>


				            
				        </div>
				    </div>
				</div>

	        		{% endfor %}
	        	</ul>
	        </section>
	    </div>

        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.10.2.min.js"><\/script>')</script>
        <script>
        	//console.log("scripts go here")

	        $(".collapse-all").bind("click", function(event){
	        	$('.panel-collapse').removeClass('in');
	        })

	        $(".expand-all").bind("click", function(event){
	        	$('.panel-collapse').addClass('in');
	        	
	        })
        </script>

    </body>
</html>
